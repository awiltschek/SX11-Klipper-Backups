[gcode_macro Test]
variable_EXTRUDER_TMP : 220

gcode:

   M117 State: {printer.print_stats.state}

  {% set z = printer.toolhead.position.z %}
  M117 Z ist aktuell: {{ z }}



#  {% set EXTRUDER_TMP = params.EXTRUDER_TEMP|default(220)|int %}
#  M117 "Heize Extruder auf {EXTRUDER_TMP} Grad"
#  SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TMP}
#  G28
#  M109 S{EXTRUDER_TMP}                  ; Wait on  Extruder Temperature
#  PRIME_LINE

#[gcode_macro T1]
#gcode:
  #ACTIVATE_EXTRUDER extruder=extruder1
  #SAVE_VARIABLE VARIABLE=currentextruder VALUE='"extruder1"'

#[gcode_macro T0]
#gcode:
  #ACTIVATE_EXTRUDER extruder=extruder
  #SAVE_VARIABLE VARIABLE=currentextruder VALUE='"extruder"'

[gcode_macro DUMP_VARIABLES]
gcode:
    {% set filter_name = params.NAME|default('')|string|lower %}
    {% set filter_value = params.VALUE|default('')|string|lower %}
    {% set show_cfg = params.SHOW_CFG|default(0)|int %}
    {% set out = [] %}
    {% for key1 in printer %}
        {% for key2 in printer[key1] %}
            {% if (show_cfg or not (key1|lower == 'configfile' and key2|lower in ['config', 'settings'])) and (filter_name in key1|lower or filter_name in key2|lower) and filter_value in printer[key1][key2]|string|lower %}
                {% set dummy = out.append("printer['%s'].%s = %s" % (key1, key2, printer[key1][key2])) %}
            {% endif %}
        {% else %}
            {% if filter_name in key1|lower and filter_value in printer[key1]|string|lower %}
                {% set dummy = out.append("printer['%s'] = %s" % (key1, printer[key1])) %}
            {% endif %}
        {% endfor %}
    {% endfor %}
    {action_respond_info(out|join("\n"))}


[gcode_macro DUMP_FILAMENT_SENSOR]
description: Debug â€“ dump all filament sensor attributes
gcode:
    {% set fs = printer["filament_switch_sensor filament_sensor"] %}

    {action_respond_info("=== FILAMENT SENSOR DUMP ===")}

    {action_respond_info("enabled: " ~ fs.enabled)}
    {action_respond_info("filament_detected: " ~ fs.filament_detected)}

    {% if fs.runout_distance is defined %}
        {action_respond_info("runout_distance: " ~ fs.runout_distance)}
    {% endif %}

    {% if fs.pause_on_runout is defined %}
        {action_respond_info("pause_on_runout: " ~ fs.pause_on_runout)}
    {% endif %}

    {% if fs.event_delay is defined %}
        {action_respond_info("event_delay: " ~ fs.event_delay)}
    {% endif %}

    {% if fs.switch_pin is defined %}
        {action_respond_info("switch_pin: " ~ fs.switch_pin)}
    {% endif %}

    {% if fs.insert_gcode is defined %}
        {action_respond_info("insert_gcode: defined")}
    {% endif %}

    {% if fs.runout_gcode is defined %}
        {action_respond_info("runout_gcode: defined")}
    {% endif %}

    {% if fs.printer_state is defined %}
        {action_respond_info("printer_state: " ~ fs.printer_state)}
    {% endif %}

    {action_respond_info("=== END FILAMENT SENSOR DUMP ===")}
